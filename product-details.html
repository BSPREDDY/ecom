<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1a1a1a">
    <meta name="description" content="Product Details - EshopHub E-commerce Platform">
    <title>Product Details - EshopHub</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/modern.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        .product-gallery {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
        }

        .product-gallery img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }

        .gallery-thumbs {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            overflow-x: auto;
        }

        .gallery-thumb {
            width: 80px;
            height: 80px;
            border-radius: 4px;
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.3s;
            overflow: hidden;
            flex-shrink: 0;
        }

        .gallery-thumb:hover,
        .gallery-thumb.active {
            opacity: 1;
            border: 2px solid #0d6efd;
        }

        .gallery-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .rating-section {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .stars {
            font-size: 20px;
            color: #ffc107;
        }

        .qty-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }

        .qty-selector button {
            width: 40px;
            height: 40px;
            border-radius: 4px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
        }

        .qty-selector input {
            width: 60px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
        }

        .product-info-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .product-card-small {
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s;
            cursor: pointer;
        }

        .product-card-small:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .product-card-small img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
    </style>
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top shadow-sm">
        <div class="container-fluid px-3 px-md-4">
            <a class="navbar-brand fw-bold fs-4" href="/">
                <i class="bi bi-shop"></i> EshopHub
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto gap-2">
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            <i class="bi bi-house"></i> Home
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="categoriesDropdown" role="button"
                            data-bs-toggle="dropdown">
                            <i class="bi bi-tag"></i> Categories
                        </a>
                        <ul class="dropdown-menu" id="categoriesMenu">
                            <li><a class="dropdown-item" href="/">All Categories</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/cart.html" id="cartLink">
                            <i class="bi bi-cart"></i> Cart
                            <span class="badge bg-warning text-dark" id="cartCount">0</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/wishlist.html" id="wishlistLink">
                            <i class="bi bi-heart"></i> Wishlist
                            <span class="badge bg-danger" id="wishlistCount">0</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <div class="bg-light py-2 sticky-top" style="top: 56px; z-index: 10;">
        <div class="container-fluid">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0 small">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item active" id="productBreadcrumb">Product</li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container-fluid py-5">
        <div class="row g-4">
            <!-- Product Gallery -->
            <div class="col-lg-6">
                <div class="product-gallery">
                    <img id="mainImage" src="https://via.placeholder.com/500" alt="Product" class="img-fluid">
                </div>
                <div class="gallery-thumbs" id="galleryThumbs">
                    <!-- Thumbnails will be loaded here -->
                </div>
            </div>

            <!-- Product Details -->
            <div class="col-lg-6">
                <p class="text-muted" id="productCategory">Category</p>
                <h1 id="productTitle" class="mb-3"></h1>

                <div class="rating-section">
                    <span class="stars" id="productStars">★★★★★</span>
                    <span id="productRating" class="text-muted">(0 reviews)</span>
                    <span class="badge bg-success" id="stockStatus">In Stock</span>
                </div>

                <div class="py-4 border-top border-bottom">
                    <div class="h3 text-primary mb-2" id="productPrice">$0.00</div>
                    <small id="originalPrice" class="text-decoration-line-through text-muted"></small>
                    <p class="text-muted mt-2 small" id="discountInfo"></p>
                </div>

                <p id="productDescription" class="text-muted my-4"></p>

                <!-- Quantity Selector -->
                <div class="qty-selector mb-4">
                    <button onclick="decreaseQty()" class="qty-btn">−</button>
                    <input type="number" id="quantity" value="1" min="1" max="10">
                    <button onclick="increaseQty()" class="qty-btn">+</button>
                    <span class="text-muted ms-3" id="stockInfo">Max: 10</span>
                </div>

                <!-- Action Buttons -->
                <div class="d-flex gap-3 mb-4 flex-wrap">
                    <button class="btn btn-primary btn-lg flex-grow-1" onclick="addToCartClick()">
                        <i class="bi bi-cart-plus"></i> Add to Cart
                    </button>
                    <button class="btn btn-outline-danger btn-lg" id="wishlistBtn" onclick="toggleWishlistClick()">
                        <i class="bi bi-heart"></i>
                    </button>
                </div>

                <!-- Product Info -->
                <div class="product-info-section">
                    <div class="info-row">
                        <span class="fw-6 00">SKU</span>
                        <span id="productSKU">N/A</span>
                    </div>
                    <div class="info-row">
                        <span class="fw-600">Brand</span>
                        <span id="productBrand">N/A</span>
                    </div>
                    <div class="info-row">
                        <span class="fw-600">Stock</span>
                        <span id="productStock">Available</span>
                    </div>
                    <div class="info-row">
                        <span class="fw-600">Availability</span>
                        <span id="productAvailability">In Stock</span>
                    </div>
                </div>

                <!-- Shipping Info -->
                <div class="alert alert-info mt-4">
                    <i class="bi bi-truck"></i> Free shipping on orders over $50
                </div>
            </div>
        </div>

        <!-- Related Products -->
        <div class="mt-5 pt-5 border-top">
            <h3 class="mb-4">Related Products</h3>
            <div class="row g-3" id="relatedProducts">
                <!-- Related products will be loaded here -->
            </div>
        </div>
    </main>

    <!-- Toast Notification -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="liveToast" class="toast align-items-center text-white bg-success border-0" role="alert"
            aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body" id="toastMessage">Success</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>



    <!-- Global Toast Function -->
    <script>
        function showToast(message, type = 'success') {
            const toastEl = document.getElementById('liveToast');
            const toastMessage = document.getElementById('toastMessage');

            if (toastEl && toastMessage) {
                toastMessage.textContent = message;
                toastEl.className = `toast align-items-center text-white bg-${type} border-0`;
                const bsToast = new bootstrap.Toast(toastEl);
                bsToast.show();
            } else {
                console.log(`[Toast] ${type}: ${message}`);
            }
        }
        window.showToast = showToast;
    </script>

    <!-- App Scripts -->
    <script src="./js/cart.js"></script>
    <script src="./js/wishlist.js"></script>

    <script>
        let currentProduct = null;
        let allProducts = [];
        let cartItems = [];
        let wishlistItems = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function () {
            loadCartFromStorage();
            loadWishlistFromStorage();
            loadProductData();
            updateCounters();
            loadCategories();
            console.log('[v0] Product details page initialized');
        });

        // Load product data from URL or API
        async function loadProductData() {
            try {
                const params = new URLSearchParams(window.location.search);
                const productId = params.get('id');

                if (!productId) {
                    console.log('[v0] No product ID in URL');
                    return;
                }

                // Fetch all products
                const response = await fetch('https://dummyjson.com/products?limit=10000');
                allProducts = (await response.json()).products || [];

                currentProduct = allProducts.find(p => p.id == productId);

                if (!currentProduct) {
                    console.log('[v0] Product not found:', productId);
                    showToast('Product not found', 'danger');
                    return;
                }

                displayProduct(currentProduct);
                setupGalleryThumbnails();
                loadRelatedProducts();
                console.log('[v0] Product loaded:', currentProduct.title);
            } catch (error) {
                console.error('[v0] Error loading product:', error);
                showToast('Error loading product', 'danger');
            }
        }

        // Display product details
        function displayProduct(product) {
            document.getElementById('productTitle').textContent = product.title;
            document.getElementById('productCategory').textContent = product.category.toUpperCase();
            document.getElementById('productBreadcrumb').textContent = product.title;

            // Main image
            const mainImage = product.images?.[0] || product.thumbnail || 'https://via.placeholder.com/500';
            document.getElementById('mainImage').src = mainImage;

            // Price
            const price = product.price.toFixed(2);
            document.getElementById('productPrice').textContent = `$${price}`;

            if (product.discountPercentage) {
                const originalPrice = (product.price / (1 - product.discountPercentage / 100)).toFixed(2);
                document.getElementById('originalPrice').textContent = `$${originalPrice}`;
                document.getElementById('discountInfo').textContent = `Save ${Math.round(product.discountPercentage)}%`;
            }

            // Rating
            const rating = product.rating || 0;
            const stars = '★'.repeat(Math.floor(rating)) + '☆'.repeat(5 - Math.floor(rating));
            document.getElementById('productStars').textContent = stars;
            document.getElementById('productRating').textContent = `${rating.toFixed(1)}/5`;

            // Description
            document.getElementById('productDescription').textContent = product.description;

            // Stock
            const stock = product.stock || 10;
            document.getElementById('productStock').textContent = `${stock} units`;
            document.getElementById('productAvailability').textContent = stock > 0 ? 'In Stock' : 'Out of Stock';
            document.getElementById('stockStatus').textContent = stock > 0 ? 'In Stock' : 'Out of Stock';
            document.getElementById('stockInfo').textContent = `Max: ${Math.min(stock, 10)}`;

            // Other info
            document.getElementById('productSKU').textContent = product.sku || 'N/A';
            document.getElementById('productBrand').textContent = product.brand || 'N/A';

            updateWishlistButton();
        }

        // Setup gallery thumbnails
        function setupGalleryThumbnails() {
            if (!currentProduct || !currentProduct.images) return;

            const thumbs = document.getElementById('galleryThumbs');
            thumbs.innerHTML = '';

            currentProduct.images.slice(0, 5).forEach((image, index) => {
                const thumb = document.createElement('div');
                thumb.className = `gallery-thumb ${index === 0 ? 'active' : ''}`;
                thumb.innerHTML = `<img src="${image}" alt="Thumbnail ${index + 1}">`;
                thumb.addEventListener('click', () => {
                    document.getElementById('mainImage').src = image;
                    document.querySelectorAll('.gallery-thumb').forEach(t => t.classList.remove('active'));
                    thumb.classList.add('active');
                });
                thumbs.appendChild(thumb);
            });
        }

        // Load related products
        async function loadRelatedProducts() {
            if (!currentProduct) return;

            const related = allProducts
                .filter(p => p.category === currentProduct.category && p.id !== currentProduct.id)
                .slice(0, 4);

            const container = document.getElementById('relatedProducts');
            container.innerHTML = related.map(product => `
                <div class="col-md-6 col-lg-3">
                    <div class="product-card-small card border">
                        <img src="${product.thumbnail || 'https://via.placeholder.com/300'}" alt="${product.title}" class="card-img-top">
                        <div class="card-body">
                            <h6 class="card-title">${product.title.substring(0, 30)}...</h6>
                            <p class="text-primary fw-bold mb-0">$${product.price.toFixed(2)}</p>
                            <button class="btn btn-sm btn-primary mt-2 w-100" onclick="goToProduct(${product.id})">
                                View
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Load categories for dropdown
        async function loadCategories() {
            try {
                const response = await fetch('https://dummyjson.com/products/categories');
                const categories = await response.json();
                const menu = document.getElementById('categoriesMenu');

                categories.slice(0, 10).forEach(cat => {
                    const li = document.createElement('li');
                    li.innerHTML = `<a class="dropdown-item" href="/?category=${cat.slug}">${cat.name}</a>`;
                    menu.appendChild(li);
                });
            } catch (error) {
                console.error('[v0] Error loading categories:', error);
            }
        }

        // Quantity controls
        function increaseQty() {
            const input = document.getElementById('quantity');
            const max = parseInt(document.getElementById('stockInfo').textContent.split(': ')[1]) || 10;
            input.value = Math.min(parseInt(input.value) + 1, max);
        }

        function decreaseQty() {
            const input = document.getElementById('quantity');
            input.value = Math.max(parseInt(input.value) - 1, 1);
        }

        // Add to cart
        function addToCartClick() {
            if (!currentProduct) return;

            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            addToCart(currentProduct, quantity);
        }

        // Add to cart function
        function addToCart(product, quantity) {
            const existingItem = cartItems.find(item => item.id === product.id);

            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cartItems.push({
                    id: product.id,
                    title: product.title,
                    price: product.price,
                    image: product.thumbnail,
                    quantity: quantity
                });
            }

            saveCartToStorage();
            updateCounters();
            showToast(`${product.title.substring(0, 30)}... added to cart!`, 'success');
            console.log('[v0] Added to cart:', product.title);
        }

        // Toggle wishlist
        function toggleWishlistClick() {
            if (!currentProduct) return;

            const index = wishlistItems.findIndex(item => item.id === currentProduct.id);

            if (index > -1) {
                wishlistItems.splice(index, 1);
                showToast('Removed from wishlist', 'success');
            } else {
                wishlistItems.push({
                    id: currentProduct.id,
                    title: currentProduct.title,
                    price: currentProduct.price,
                    image: currentProduct.thumbnail,
                    category: currentProduct.category
                });
                showToast('Added to wishlist!', 'success');
            }

            saveWishlistToStorage();
            updateCounters();
            updateWishlistButton();
        }

        // Update wishlist button state
        function updateWishlistButton() {
            if (!currentProduct) return;

            const btn = document.getElementById('wishlistBtn');
            const isInWishlist = wishlistItems.some(item => item.id === currentProduct.id);

            if (isInWishlist) {
                btn.classList.remove('btn-outline-danger');
                btn.classList.add('btn-danger');
                btn.innerHTML = '<i class="bi bi-heart-fill"></i> Remove';
            } else {
                btn.classList.remove('btn-danger');
                btn.classList.add('btn-outline-danger');
                btn.innerHTML = '<i class="bi bi-heart"></i> Wishlist';
            }
        }

        // Navigate to product
        function goToProduct(productId) {
            window.location.href = `/product-details.html?id=${productId}`;
        }

        // Storage functions
        function loadCartFromStorage() {
            try {
                cartItems = JSON.parse(localStorage.getItem('cart')) || [];
            } catch (e) {
                cartItems = [];
            }
        }

        function saveCartToStorage() {
            localStorage.setItem('cart', JSON.stringify(cartItems));
        }

        function loadWishlistFromStorage() {
            try {
                wishlistItems = JSON.parse(localStorage.getItem('wishlist')) || [];
            } catch (e) {
                wishlistItems = [];
            }
        }

        function saveWishlistToStorage() {
            localStorage.setItem('wishlist', JSON.stringify(wishlistItems));
        }

        // Update counters
        function updateCounters() {
            document.getElementById('cartCount').textContent = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('wishlistCount').textContent = wishlistItems.length;
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('liveToast');
            const toastBody = document.getElementById('toastMessage');

            toastBody.textContent = message;
            toast.className = `toast align-items-center text-white border-0 bg-${type}`;

            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }
    </script>
</body>

</html>